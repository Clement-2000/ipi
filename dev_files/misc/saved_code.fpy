COLORS = "TRUE_COLOR" # TRUE_COLOR 256_COLOR 16_COLOR MONOCRHOME
STYLE = "BOX_BRIGHTNESS" # BOXES BOX_BRIGHTNESS CHAR_BRIGHTNESS CHAR_BRIGHTNESS_VARIATING
BRIGHTNESS_SHIFT = True # True False
REVERSE = False # True False

RANDOM_SEED = random.randint(1, 10)

with open("brightness_char.txt") as brightness_char_file :
    BRIGHTNESS_CHAR = brightness_char_file.read()
BRIGHTNESS_CHAR_LENTH = len(BRIGHTNESS_CHAR)


def clearMatrix(self):
        self.matrix = (" " * self.width + "\n")*(self.height - 1) + " " * self.width
    
    def setGraphic(self, graphic):
        #assert str(type(graphic)) == "<class 'PIL.PngImagePlugin.PngImageFile'>"

        self.graphic = graphic
    
    def addMenu():
        pass

    def updateMatrix(self): 

        graphic = self.graphic.resize((self.width, self.height))

        self.matrix = ""
        for y in range(graphic.height):
            for x in range(graphic.width):
                px = graphic.getpixel((x, y))

                r = px[0] 
                g = px[1] 
                b = px[2] 
                v = (0.2126*r + 0.7152*g + 0.0722*b) / 255

                if BRIGHTNESS_SHIFT : 
                    factor = 1 if max(px) == 0 else max(px)/255
                    r = round(r/factor)
                    g = round(g/factor)
                    b = round(b/factor)
                
                fac = 1
                
                if COLORS == "TRUE_COLOR" :
                    if REVERSE :
                        self.matrix += f"\033[48;2;{r};{g};{b}m"
                        self.matrix += f"\033[38;2;{round(255-v*255)};{round(255-v*255)};{round(255-v*255)}m"
                        fac = -1
                    else :
                        self.matrix += f"\033[38;2;{r};{g};{b}m"
                        self.matrix += f"\033[48;2;0;0;0m"
                elif COLORS == "256_COLOR" :
                    pass
                elif COLORS == "16_COLOR" :
                    pass

                if STYLE == "BOX_BRIGHTNESS" :
                    self.matrix += " ░▒▓█"[math.floor(v*5.3)]
                elif STYLE == "CHAR_BRIGHTNESS" :
                    self.matrix += "          ,;\"=+/||<>()i\\%{}lcr*[]!Is!x?vt1z7aefunoLJCCj3£2YT5w9PF49PZ6mbkdZVhGpq&$uAXE0gu&DOK@H8RBW#"[math.floor(v*100)]
                elif STYLE == "CHAR_BRIGHTNESS_VARIATING" :
                    self.matrix += "          ,;\"=+/||<>()i\\%{}lcr*[]!Is!x?vt1z7aefunoLJCCj3£2YT5w9PF49PZ6mbkdZVhGpq&$uAXE0gu&DOK@H8RBW#"[(math.floor(v*10)*10 + (random.randint(1, 10)*(x+y))%10)]
                else : 
                    self.matrix += "█"
            self.matrix += "\n"
        
        self.matrix = self.matrix[:-1]
